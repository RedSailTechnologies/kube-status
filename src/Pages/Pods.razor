@page "/pods/{namespaceparam?}"

@using System

@inject NamespaceService NamespaceService
@inject PodService PodService
@inject IJSRuntime JS

<h1>Pods</h1>

@if (GetNamespacesError)
{
    <div class="alert alert-danger" role="alert">
        Unable to get namespaces. Please try again later.
    </div>
}
else
{
    <div class="form-group row mb-3">
        <div class="col-sm-4">
            <label for="namespaceSelect" class="form-label">Select a Namespace</label>
            <select class="form-select" id="namespaceSelect" @onchange="@OnSelect">
                @foreach (var ns in Namespaces)
                {
                    @if (@ns.Equals(@SelectedNamespace))
                    {
                        <option value=@ns selected>@ns</option>
                    }
                    else
                    {
                        <option value=@ns>@ns</option>
                    }
                }
            </select>
        </div>
        <div class="col-sm-2 offset-sm-4">
            <button class="btn btn-outline-dark btn-sm" @onclick="() => GetPodCsv()">Download Pod List</button>
        </div>
        <div class="col-sm-2">
            <label for="logRows" class="form-label">Log Rows</label>
            <input type="number" class="form-control" id="logRows" @bind-value="LogRows">
        </div>
    </div>
    <div class="form-group row mb-3">
        <div class="col-sm-4">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Search..." aria-label="Filter"
                aria-describedby="button-clear" @bind-value="Filter" @oninput="@FilterChange">
                <button class="btn btn-outline-secondary" type="button" id="button-clear"
                @onclick="@ClearFilter">Clear</button>
            </div>
        </div>
        <div class="col-sm-2">
            <div class="form-check">
                <input class="form-check-input" id="SearchPodNameCheckbox" type="checkbox" checked="@SearchPodName"
                @bind-value="SearchPodName" @onclick="@SearchPodNameChange">
                <label class="form-check-label" for="SearchPodNameCheckbox">Search Pod Names</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" id="SearchContainerNameCheckbox" type="checkbox"
                checked="@SearchContainerName" @bind-value="SearchContainerName" @onclick="@SearchContainerNameChange">
                <label class="form-check-label" for="SearchContainerNameCheckbox">Search Container Names</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" id="SearchInitContainerNameCheckbox" type="checkbox"
                checked="@SearchInitContainerName" @bind-value="SearchInitContainerName"
                @onclick="@SearchInitContainerNameChange">
                <label class="form-check-label" for="SearchInitContainerNameCheckbox">Search Init Container Names</label>
            </div>
        </div>
    </div>
}
@if (GetPodsError)
{
    <div class="alert alert-danger" role="alert">
        Unable to get pods. Please try again later.
    </div>
}
else
{
    @if (@NamespacedPods != null && @NamespacedPods.Any())
    {
        <TableTemplate Items="FilteredPods" TItem="Pod" TableHeaderClass="thead-light">
            <TableHeader>
                <th>
                    <div class="form-group row">
                        <div class="col-xl-4 d-none d-xl-block">
                            <label class="form-label"><b>Pod</b></label>
                        </div>
                        <div class="col-xl-1 d-none d-xl-block">
                            <label class="form-label"><b>Component</b></label>
                        </div>
                        <div class="col-xl-1 d-none d-xl-block">
                            <label class="form-label"><b>Part Of</b></label>
                        </div>
                        <div class="col-xl-1 d-none d-xl-block">
                            <label class="form-label"><b>Version</b></label>
                        </div>
                        <div class="col-xl-1 d-none d-xl-block">
                            <label class="form-label"><b>Status</b></label>
                        </div>
                        <div class="col-xl-1 d-none d-xl-block">
                            <label class="form-label"><b>Created</b></label>
                        </div>
                    </div>
                </th>
            </TableHeader>
            <RowTemplate>
                <td>
                    <div class="form-group row">
                        <div class="col-xl-4">
                            <h5 id="name-@context.PodName.Replace(".","-")" class="form-item">
                                @(string.IsNullOrWhiteSpace(context.Name) ? context.PodName : context.Name)</h5>
                        </div>
                        <div class="col-xl-1">
                            @if (!string.IsNullOrWhiteSpace(context.Component))
                            {
                                <label for="component-@context.PodName.Replace(".","-")"
                        class="form-label d-xl-none"><b>Component:</b></label>
                                <span id="component-@context.PodName.Replace(".","-")"
                        class="form-item small">@context.Component</span>
                            }
                        </div>
                        <div class="col-xl-1">
                            @if (!string.IsNullOrWhiteSpace(context.PartOf))
                            {
                                <label for="part-of-@context.PodName.Replace(".","-")" class="form-label d-xl-none"><b>Part
                                        Of:</b></label>
                                <span id="part-of-@context.PodName.Replace(".","-")" class="form-item small">@context.PartOf</span>
                            }
                        </div>
                        <div class="col-xl-1">
                            @if (!string.IsNullOrWhiteSpace(context.Version))
                            {
                                <label for="version-@context.PodName.Replace(".","-")"
                        class="form-label d-xl-none"><b>Version:</b></label>
                                <span id="version-@context.PodName.Replace(".","-")" class="form-item small">@context.Version</span>
                            }
                        </div>
                        <div class="col-xl-1">
                            <label for="status-@context.PodName.Replace(".","-")"
                        class="form-label d-xl-none"><b>Status:</b></label>
                            <span id="status-@context.PodName.Replace(".","-")"
                        class="form-item small">@context.PodStatus</span>
                        </div>
                        <div class="col-xl-1">
                            <label for="created-@context.PodName.Replace(".","-")"
                        class="form-label d-xl-none"><b>Created:</b></label>
                            <span id="created-@context.PodName.Replace(".","-")" class="form-item small">
                                @if (context.PodCreated.HasValue)
                                {
                                    @context.PodCreated.Value.ToString("u")
                                    ;
                                }
                            </span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-8 col-lg-12">
                            @if ((context.Containers != null && context.Containers.Any()) || (context.InitContainers != null &&
                           context.InitContainers.Any()))
                            {
                                <button class="btn btn-outline-dark btn-sm m-2 collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#@context.PodName.Replace(".","-")-collapseMoreDetails" aria-expanded="false"
                        aria-controls="collapseMoreDetails">
                                    <span class="show">Show</span><span class="hide">Hide</span> More Details
                                </button>
                            }

                            @if (context.Labels != null && context.Labels.Any())
                            {
                                <button class="btn btn-outline-dark btn-sm m-2 collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#@context.PodName.Replace(".","-")-collapseLabels" aria-expanded="false"
                        aria-controls="collapseLabels">
                                    <span class="show">Show</span><span class="hide">Hide</span> Pod Labels
                                </button>
                            }

                            @if (context.Annotations != null && context.Annotations.Any())
                            {
                                <button class="btn btn-outline-dark btn-sm m-2 collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#@context.PodName.Replace(".","-")-collapseAnnotations" aria-expanded="false"
                        aria-controls="collapseAnnotations">
                                    <span class="show">Show</span><span class="hide">Hide</span> Pod Annotations
                                </button>
                            }

                            @if (context.Affinity != null || (context.Tolerations != null && context.Tolerations.Any()))
                            {
                                <button class="btn btn-outline-dark btn-sm m-2 collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#@context.PodName.Replace(".","-")-collapseAffinityAndTolerations"
                        aria-expanded="false" aria-controls="collapseAffinityAndTolerations">
                                    <span class="show">Show</span><span class="hide">Hide</span> Affinity & Tolerations
                                </button>
                            }

                            @if (context.PodVolumes != null && context.PodVolumes.Any())
                            {
                                <button class="btn btn-outline-dark btn-sm m-2 collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#@context.PodName.Replace(".","-")-collapsePodVolumes" aria-expanded="false"
                        aria-controls="collapsePodVolumes">
                                    <span class="show">Show</span><span class="hide">Hide</span> Pod Volumes
                                </button>
                            }

                            @if (context.Events != null && context.Events.Any())
                            {
                                <button class="btn btn-outline-dark btn-sm m-2 collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#@context.PodName.Replace(".","-")-collapseEvents" aria-expanded="false"
                        aria-controls="collapseEvents">
                                    <span class="show">Show</span><span class="hide">Hide</span> Events
                                </button>
                            }
                        </div>
                    </div>
                    <div class="row mb-2">
                        @if ((context.Containers != null && context.Containers.Any()) || (context.InitContainers != null &&
                       context.InitContainers.Any()))
                        {
                            <div class="collapse col-sm-12" id="@context.PodName.Replace(".","-")-collapseMoreDetails">
                                <div class="alert alert-info mb-2"><strong>Pod Name:</strong> @context.PodName</div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <label for="node-name-@context.PodName.Replace(".","-")" class="form-label"><b>Node
                                                Name</b></label>
                                        <p>@context.NodeName</p>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="node-ip-@context.PodName.Replace(".","-")" class="form-label"><b>Node
                                                IP</b></label>
                                        <p>@context.HostIP</p>
                                    </div>
                                    <div class="col-md-4">
                                        @if (@context.PodIPs != null && context.PodIPs.Any())
                                        {
                                            @if (@context.PodIPs.Count > 1)
                                            {
                                                <label for="ip-@context.PodName.Replace(".","-")" class="form-label"><b>Pod IPs</b></label>
                                                <div id="ip-@context.PodName.Replace(".","-")" class="form-item">
                                                    <ul>
                                                        @foreach (var ip in context.PodIPs)
                                                        {
                                                            <li>@ip</li>
                                                        }
                                                    </ul>
                                                </div>
                                            }
                                            else if (@context.PodIPs.Count == 1)
                                            {
                                                <label for="ip-@context.PodName.Replace(".","-")" class="form-label"><b>Pod IP</b></label>
                                                <div id="ip-@context.PodName.Replace(".","-")" class="form-item">@context.PodIPs[0]</div>
                                            }
                                            else
                                            {
                                                <div class="alert alert-warning">No Pod IP address was assigned.</div>
                                            }
                                        }
                                    </div>
                                </div>
                                @if (context.InitContainers != null && context.InitContainers.Any())
                                {
                                    <h5>Init Containers</h5>
                                    <TableTemplate
                        Items="@context.InitContainers.Select(s => new { s.ContainerStatus.Name, s.ContainerStatus.Started, s.ContainerStatus.Ready, s.ContainerStatus.RestartCount, s.ContainerStatus.Image, s.ContainerStatus.ImageID, s.ContainerStatus.LastState }).OrderBy(s => s.Name)"
                        TableClass="table-sm table-striped">
                                        <RowTemplate Context="statusContext">
                        <td>
                            <div class="form-group container-fluid row mb-1">
                                <div class="col-xl-2">
                                    <div class="mb-2">
                                        <label
                            for="name-@context.PodName.Replace(".","-")-@statusContext.Name"><b>Container:</b></label>
                                        <span id="name-@context.PodName.Replace(".","-")-@statusContext.Name"
                            class="form-item">@statusContext.Name</span>
                                    </div>
                                    <div class="row">
                                        <button class="btn btn-outline-dark btn-sm col-6"
                            @onclick="() => GetLogs(context.Namespace, context.PodName, statusContext.Name)">Logs</button>
                                    </div>
                                </div>
                                <div class="col-xl-1">
                                    <div class="small mb-2">
                                        <label
                            for="started-@context.PodName.Replace(".","-")-@statusContext.Name"><b>Started:</b></label>
                                        <span id="started-@context.PodName.Replace(".","-")-@statusContext.Name"
                            class="form-item">@statusContext.Started</span>
                                    </div>
                                    <div class="small mb-2">
                                        <label for="ready-@context.PodName.Replace(".","-")-@statusContext.Name"><b>Ready:</b></label>
                                        <span id="ready-@context.PodName.Replace(".","-")-@statusContext.Name"
                            class="form-item">@statusContext.Ready</span>
                                    </div>
                                    <div class="small mb-2">
                                        <label for="restart-count-@context.PodName.Replace(".","-")-@statusContext.Name"><b>Restart
                                                Count:</b></label>
                                        <span id="restart-count-@context.PodName.Replace(".","-")-@statusContext.Name"
                            class="form-item">@statusContext.RestartCount</span>
                                    </div>
                                </div>
                                <div class="col-xl-5">
                                                        @if (statusContext.LastState.Running != null || statusContext.LastState.Waiting != null ||
                    statusContext.LastState.Terminated != null)
                                        {
                        <label class="form-label small"><b>Last State</b></label>
                        <pre>@statusContext.LastState.ToYaml()</pre>
                                        }
                </div>
                <div class="col-xl-4">
                    <div class="small mb-2">
                        <label for="image-@context.PodName.Replace(".","-")-@statusContext.Name"><b>Image:</b></label>
                        <span id="image-@context.PodName.Replace(".","-")-@statusContext.Name" class="form-item">
                                                @if (statusContext.ImageID?.Split('@').Length > 1)
                                                {
                                                    @statusContext.ImageID?.Split('@')[0]
                                                }
                                                else
                                                {
                                                    @statusContext.Image?.Split(':')[0]
                                                }
                        </span>
                    </div>
                    <div class="small mb-2">
                        <label for="tag-@context.PodName.Replace(".","-")-@statusContext.Name"><b>Tag:</b></label>
                        <span id="tag-@context.PodName.Replace(".","-")-@statusContext.Name" class="form-item">
                                                @if (statusContext.Image.StartsWith("sha"))
                                                {
                                                    @statusContext.Image
                                                }
                                                else
                                                {
                                                    @statusContext.Image?.Split(':')[1]
                                                }
                        </span>
                    </div>
                    <div class="small mb-2">
                        <label for="image-id-@context.PodName.Replace(".","-")-@statusContext.Name"><b>Image
                                ID:</b></label>
                        <span id="image-id-@context.PodName.Replace(".","-")-@statusContext.Name" class="form-item">
                                                @if (statusContext.ImageID?.Split('@').Length > 1)
                                                {
                                                    @statusContext.ImageID?.Split('@')[1]
                                                }
                        </span>
                    </div>
                </div>
            </div>
        </td>
    </RowTemplate>
</TableTemplate>
                                }
                                @if (context.Containers != null && context.Containers.Any())
                                {
                <h5>Containers</h5>
                <TableTemplate
    Items="@context.Containers.Select(s => new { s.ContainerStatus.Name, s.ContainerStatus.Started, s.ContainerStatus.Ready, s.ContainerStatus.RestartCount, s.ContainerStatus.Image, s.ContainerStatus.ImageID, s.ContainerStatus.LastState }).OrderBy(s => s.Name)"
    TableClass="table-sm table-striped">
                    <RowTemplate Context="statusContext">
                        <td>
                            <div class="form-group container-fluid row mb-1">
                                <div class="col-xl-2">
                                    <div class="mb-2">
                                        <label
                            for="name-@context.PodName.Replace(".","-")-@statusContext.Name"><b>Container:</b></label>
                                        <span id="name-@context.PodName.Replace(".","-")-@statusContext.Name"
                            class="form-item">@statusContext.Name</span>
                                    </div>
                                    <div class="row">
                                        <button class="btn btn-outline-dark btn-sm col-6"
                            @onclick="() => GetLogs(context.Namespace, context.PodName, statusContext.Name)">Logs</button>
                                    </div>
                                </div>
                                <div class="col-xl-1">
                                    <div class="small mb-2">
                                        <label
                            for="started-@context.PodName.Replace(".","-")-@statusContext.Name"><b>Started:</b></label>
                                        <span id="started-@context.PodName.Replace(".","-")-@statusContext.Name"
                            class="form-item">@statusContext.Started</span>
                                    </div>
                                    <div class="small mb-2">
                                        <label for="ready-@context.PodName.Replace(".","-")-@statusContext.Name"><b>Ready:</b></label>
                                        <span id="ready-@context.PodName.Replace(".","-")-@statusContext.Name"
                            class="form-item">@statusContext.Ready</span>
                                    </div>
                                    <div class="small mb-2">
                                        <label for="restart-count-@context.PodName.Replace(".","-")-@statusContext.Name"><b>Restart
                                                Count:</b></label>
                                        <span id="restart-count-@context.PodName.Replace(".","-")-@statusContext.Name"
                            class="form-item">@statusContext.RestartCount</span>
                                    </div>
                                </div>
                                <div class="col-xl-5">
                                                        @if (statusContext.LastState.Running != null || statusContext.LastState.Waiting != null ||
                    statusContext.LastState.Terminated != null)
                                        {
                        <label class="form-label small"><b>Last State</b></label>
                        <pre>@statusContext.LastState.ToYaml()</pre>
                                        }
                </div>
                <div class="col-xl-4">
                    <div class="small mb-2">
                        <label for="image-@context.PodName.Replace(".","-")-@statusContext.Name"><b>Image:</b></label>
                        <span id="image-@context.PodName.Replace(".","-")-@statusContext.Name" class="form-item">
                                                @if (statusContext.ImageID?.Split('@').Length > 1)
                                                {
                                                    @statusContext.ImageID?.Split('@')[0]
                                                }
                                                else
                                                {
                                                    @statusContext.Image?.Split(':')[0]
                                                }
                        </span>
                    </div>
                    <div class="small mb-2">
                        <label for="tag-@context.PodName.Replace(".","-")-@statusContext.Name"><b>Tag:</b></label>
                        <span id="tag-@context.PodName.Replace(".","-")-@statusContext.Name" class="form-item">
                                                @if (statusContext.Image.StartsWith("sha"))
                                                {
                                                    @statusContext.Image
                                                }
                                                else
                                                {
                                                    @statusContext.Image?.Split(':')[1]
                                                }
                        </span>
                    </div>
                    <div class="small mb-2">
                        <label for="image-id-@context.PodName.Replace(".","-")-@statusContext.Name"><b>Image
                                ID:</b></label>
                        <span id="image-id-@context.PodName.Replace(".","-")-@statusContext.Name" class="form-item">
                                                @if (statusContext.ImageID?.Split('@').Length > 1)
                                                {
                                                    @statusContext.ImageID?.Split('@')[1]
                                                }
                        </span>
                    </div>
                </div>
            </div>
        </td>
    </RowTemplate>
</TableTemplate>
                                }
            </div>
                        }
        </div>
        <div class="row mb-2">
                        @if (context.Labels != null && context.Labels.Any())
                        {
                <div class="collapse col-sm-12" id="@context.PodName.Replace(".","-")-collapseLabels">
                    <TableTemplate Items="@context.Labels" TableClass="table-sm table-striped">
                        <TableHeader>
                            <th colspan="2">Labels</th>
                        </TableHeader>
                        <RowTemplate Context="labelsContext">
                            <td>@labelsContext.Key</td>
                            <td>@labelsContext.Value</td>
                        </RowTemplate>
                    </TableTemplate>
                </div>
                        }
        </div>
        <div class="row mb-2">
                        @if (context.Annotations != null && context.Annotations.Any())
                        {
                <div class="collapse col-sm-12" id="@context.PodName.Replace(".","-")-collapseAnnotations">
                    <TableTemplate Items="@context.Annotations" TableClass="table-sm table-striped">
                        <TableHeader>
                            <th colspan="2">Annotations</th>
                        </TableHeader>
                        <RowTemplate Context="annotationsContext">
                            <td>@annotationsContext.Key</td>
                            <td>@annotationsContext.Value</td>
                        </RowTemplate>
                    </TableTemplate>
                </div>
                        }
        </div>
        <div class="row mb-2">
                        @if (context.Affinity != null || (context.Tolerations != null && context.Tolerations.Any()))
                        {
                <div class="collapse col-sm-12" id="@context.PodName.Replace(".","-")-collapseAffinityAndTolerations">
                                @if (context.Affinity != null)
                                {
                        <h5>Affinity</h5>
                        <pre>@context.Affinity.ToYaml()</pre>
                                }
                                @if (context.Tolerations != null && context.Tolerations.Any())
                                {
                        <h5>Tolerations</h5>
                        <TableTemplate Items="@context.Tolerations" TableClass="table-sm table-striped">
                            <TableHeader>
                                <th>Key</th>
                                <th>Operator</th>
                                <th>Value</th>
                                <th>Effect</th>
                                <th>Seconds</th>
                            </TableHeader>
                            <RowTemplate Context="tolerationsContext">
                                <td>@tolerationsContext.Key</td>
                                <td>@tolerationsContext.OperatorProperty</td>
                                <td>@tolerationsContext.Value</td>
                                <td>@tolerationsContext.Effect</td>
                                <td>@tolerationsContext.TolerationSeconds</td>
                            </RowTemplate>
                        </TableTemplate>
                                }
                </div>
                        }
        </div>
        <div class="row mb-2">
                        @if (context.PodVolumes != null && context.PodVolumes.Any())
                        {
                <div class="collapse col-sm-12" id="@context.PodName.Replace(".","-")-collapsePodVolumes">
                    <TableTemplate Items="@context.PodVolumes" TableClass="table-sm table-striped">
                        <TableHeader>
                            <th>Volumes</th>
                        </TableHeader>
                        <RowTemplate Context="podVolumesContext">
                            <td>@podVolumesContext</td>
                        </RowTemplate>
                    </TableTemplate>
                </div>
                        }
        </div>
        <div class="row mb-2">
                        @if (context.Events != null && context.Events.Any())
                        {
                <div class="collapse col-sm-12" id="@context.PodName.Replace(".","-")-collapseEvents">
                    <TableTemplate Items="@context.Events" TableClass="table-sm table-striped">
                        <TableHeader>
                            <th>Events</th>
                        </TableHeader>
                        <RowTemplate Context="eventsContext">
                            <td>
                                <div>
                                    <b>@eventsContext.Message</b>
                                </div>
                                            @if (!string.IsNullOrWhiteSpace(@eventsContext.Source?.Component) ||
                    !string.IsNullOrWhiteSpace(@eventsContext.Source?.Host))
                                            {
                        <div>
                            <label><b>Source:</b></label>&nbsp;<span class="form-item">@eventsContext.Source?.Component
                                            @eventsContext.Source?.Host</span>
                        </div>
                                            }
                                @if (eventsContext.Count != null)
                                            {
                        <div>
                            <label><b>Count:</b></label>&nbsp;<span class="form-item">@eventsContext.Count</span>
                        </div>
                                            }
                                @if (!string.IsNullOrWhiteSpace(eventsContext.InvolvedObject?.FieldPath))
                                            {
                        <div>
                            <label><b>Involved Object:</b></label>&nbsp;<span
                            class="form-item">@eventsContext.InvolvedObject.FieldPath</span>
                        </div>
                                            }
                                @if (eventsContext.LastTimestamp != null)
                                            {
                        <div>
                            <label><b>Last Seen:</b></label>&nbsp;<span
                            class="form-item">@eventsContext.LastTimestamp</span>
                        </div>
                                            }
                </td>
            </RowTemplate>
        </TableTemplate>
    </div>
                        }
        </div>
        </td>
        </RowTemplate>
        </TableTemplate>
    }
    else if (NamespacedPods == null)
    {
        <div class="alert alert-info" role="alert">
            Loading Pods in the @SelectedNamespace namespace...
        </div>
    }
    else
    {
        <div class="alert alert-primary" role="alert">
            No Pods found in the @SelectedNamespace namespace
        </div>
    }
}

@code {
    [Parameter]
    public string NamespaceParam { get; set; }

    string Filter;
    bool SearchPodName = true;
    bool SearchContainerName;
    bool SearchInitContainerName;

    bool GetNamespacesError;
    bool GetPodsError;
    bool _shouldRender;
    IEnumerable<string> Namespaces = Array.Empty<string>();
    string SelectedNamespace = "default";
    IEnumerable<Pod> NamespacedPods;
    IEnumerable<Pod> FilteredPods;
    int LogRows = 1000;


    protected override bool ShouldRender() => _shouldRender;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            NamespaceParam = NamespaceParam ?? "default";
            SelectedNamespace = NamespaceParam;

            var namespaces = await NamespaceService.GetAllNamespacesAsync();
            Namespaces = namespaces.Items.Select(i => i.Metadata.Name);

            await GetPods();

            _shouldRender = true;
        }
        catch
        {
            GetNamespacesError = true;
            GetPodsError = true;
        }
    }

    async Task OnSelect(ChangeEventArgs e)
    {
        SelectedNamespace = e.Value.ToString();
        await GetPods();
    }

    async Task GetPods()
    {
        NamespacedPods = null;
        FilteredPods = new List<Pod>();
        NamespacedPods = await PodService.GetAllNamespacedPodsAsync(SelectedNamespace);
        FilteredPods = NamespacedPods;
    }

    async Task GetLogs(string k8sNamespace, string podName, string name)
    {
        var logApi = $"/api/logs/{k8sNamespace}/{podName}/{name}?tail={LogRows}";
        await JS.InvokeVoidAsync("triggerFileDownload", "", logApi);
    }

    async Task GetPodCsv()
    {
        var podCsv = $"/api/pods/{SelectedNamespace}/csv";
        await JS.InvokeVoidAsync("triggerFileDownload", "", podCsv);
    }

    async Task FilterChange(ChangeEventArgs e)
    {
        Filter = e?.Value?.ToString();
        await FilterResults();
    }

    async Task ClearFilter()
    {
        Filter = "";
        await FilterResults();
    }

    async Task SearchPodNameChange()
    {
        SearchPodName = !SearchPodName;
        await FilterResults();
    }

    async Task SearchContainerNameChange()
    {
        SearchContainerName = !SearchContainerName;
        await FilterResults();
    }

    async Task SearchInitContainerNameChange()
    {
        SearchInitContainerName = !SearchInitContainerName;
        await FilterResults();
    }

    async Task FilterResults()
    {
        if (string.IsNullOrWhiteSpace(Filter) || (!SearchPodName && !SearchContainerName && !SearchInitContainerName))
        {
            FilteredPods = NamespacedPods;
        }
        else
        {
            FilteredPods = NamespacedPods.Where(p =>
            (SearchPodName && p.Name.Contains(Filter, StringComparison.OrdinalIgnoreCase)) ||
            (SearchContainerName && p.Containers != null && p.Containers.Any(c => c.ContainerStatus.Name.Contains(Filter,
            StringComparison.OrdinalIgnoreCase))) ||
            (SearchInitContainerName && p.InitContainers != null && p.InitContainers.Any(c =>
            c.ContainerStatus.Name.Contains(Filter, StringComparison.OrdinalIgnoreCase)))
            ).ToList();
        }
        // refresh ui after text change
        await InvokeAsync(() =>
        {
            base.StateHasChanged();
        });
    }
}